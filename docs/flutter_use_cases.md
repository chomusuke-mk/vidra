# Casos de uso de la app Flutter y sus endpoints

La tabla siguiente resume 21 interacciones clave que la app Flutter puede habilitar, junto con los endpoints del backend FastAPI que las soportan.

| #   | Caso de uso (Flutter)                                  | Descripción                                                                           | Endpoints backend                                                                            |
| --- | ------------------------------------------------------ | ------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------- |
| 1   | Comprobar disponibilidad del servicio                  | Al abrir la app se valida que el backend esté vivo y se obtiene un resumen general.   | `GET /` (healthcheck), `GET /api/jobs` (resumen en `summary`).                               |
| 2   | Crear una descarga de un solo video                    | El usuario pega una URL única y lanza un nuevo trabajo inmediato.                     | `POST /api/jobs`.                                                                            |
| 3   | Crear una descarga de playlist con selección posterior | El usuario envía una playlist grande para decidir después qué elementos descargar.    | `POST /api/jobs` (con metadatos que disparan `selection_required`).                          |
| 4   | Previsualizar metadatos antes de crear un trabajo      | Se muestra título, duración y miniaturas antes de confirmar la descarga.              | `POST /api/preview`.                                                                         |
| 5   | Ejecutar un "dry-run" para revisar los argumentos CLI  | Usuarios avanzados revisan las opciones que usará yt-dlp antes de iniciar el trabajo. | `POST /api/jobs/dry-run`.                                                                    |
| 6   | Listar todos los trabajos en curso                     | Vista principal con la cola completa y progreso resumido.                             | `GET /api/jobs`.                                                                             |
| 7   | Filtrar trabajos por estado                            | Vista segmentada (p. ej. solo `running` o `failed`).                                  | `GET /api/jobs?status=running`.                                                              |
| 8   | Filtrar trabajos por propietario                       | Un usuario ve únicamente sus descargas.                                               | `GET /api/jobs?owner={userId}`.                                                              |
| 9   | Consultar el detalle completo de un trabajo            | Pantalla con progreso, archivos generados, totales y opciones.                        | `GET /api/jobs/{job_id}`.                                                                    |
| 10  | Revisar los logs de un trabajo                         | Se renderiza el historial cronológico de mensajes.                                    | `GET /api/jobs/{job_id}/logs`.                                                               |
| 11  | Mostrar un resumen de playlist para un trabajo         | Se presenta el estado general (cuántos ítems, porcentaje, etc.).                      | `GET /api/jobs/{job_id}/playlist`.                                                           |
| 12  | Descargar la lista completa de entradas de la playlist | Para pintar listados o cuadros de selección detallados.                               | `GET /api/jobs/{job_id}/playlist/items` o `GET /api/jobs/{job_id}/playlist?include=entries`. |
| 13  | Confirmar la selección de elementos de una playlist    | El usuario marca qué videos quiere y reanuda el flujo.                                | `POST /api/jobs/{job_id}/playlist/selection`.                                                |
| 14  | Cancelar un trabajo activo                             | Botón "Cancelar" al detectar errores o arrepentimiento.                               | `POST /api/jobs/{job_id}/cancel`.                                                            |
| 15  | Cancelar múltiples trabajos de una vez                 | Acción masiva desde la vista de lista.                                                | `POST /api/jobs/cancel` (con `job_ids` o `scope="all"`).                                     |
| 16  | Pausar un trabajo                                      | Permite detener temporalmente una descarga en curso.                                  | `POST /api/jobs/{job_id}/pause`.                                                             |
| 17  | Reanudar un trabajo pausado                            | Continúa un trabajo que estaba en pausa.                                              | `POST /api/jobs/{job_id}/resume`.                                                            |
| 18  | Reintentar un trabajo fallido                          | Relanza la descarga tras corregir un error.                                           | `POST /api/jobs/{job_id}/retry`.                                                             |
| 19  | Eliminar un trabajo finalizado                         | Limpia la cola y el historial local.                                                  | `DELETE /api/jobs/{job_id}`.                                                                 |
| 20  | Consultar perfiles/preajustes (futuro)                 | UI que mostrará preajustes disponibles cuando la característica exista.               | `GET /api/profiles`.                                                                         |
| 21  | Recibir contenido desde el intent de compartir (Android) | Al compartir texto o URLs desde otra app aparece una hoja superpuesta con acciones rápidas (Video/Audio preset u “Otras descargas”) que lanza nuevos trabajos. | `POST /api/jobs` (con metadatos de origen `share_intent`), WebSocket `overview` para reflejar la nueva descarga en UI. |

> Nota: aunque la app utiliza WebSockets para actualizaciones en tiempo real (`SocketEvent.*`), todos los flujos supervisados arriba cuentan con endpoints REST para bootstrap y acciones explícitas.

> **Tip:** los endpoints de vista previa y dry-run (`POST /api/preview`, `POST /api/jobs/dry-run`) están deshabilitados por defecto para minimizar la superficie de ataque. Define `VIDRA_ENABLE_PREVIEW_API=1` (o `true`) en el entorno antes de iniciar el backend si necesitas exponerlos para depuración avanzada.
